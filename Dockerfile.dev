FROM node:22-bookworm

# Minimal tooling
RUN apt-get update \
  && apt-get install -y --no-install-recommends git openssh-client ca-certificates \
  && rm -rf /var/lib/apt/lists/*

# Enable pnpm via corepack
RUN corepack enable

WORKDIR /workspace

# Warm pnpm store for faster installs
COPY package.json pnpm-lock.yaml* ./
RUN pnpm install --frozen-lockfile || pnpm install

# Ensure watchers work inside containers
ENV CHOKIDAR_USEPOLLING=1
ENV WATCHPACK_POLLING=true
ENV HOST=0.0.0.0

# Install dependencies at runtime (handles bind-mounted source) then run dev servers
CMD ["bash", "-lc", "pnpm install --frozen-lockfile && pnpm dev"]
